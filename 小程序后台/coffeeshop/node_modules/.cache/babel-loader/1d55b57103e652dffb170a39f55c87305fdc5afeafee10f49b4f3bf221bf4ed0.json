{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nconst axios = require('axios');\n// 配置常量\nconst CONFIG = {\n  appId: 'wx6872b1e938e23c07',\n  appSecret: 'bb0342f524bf2fe87416defe5797f40a',\n  env: 'cloud1-6gzxjy5k59c1f367'\n};\nexport default {\n  name: 'goodsList',\n  data() {\n    return {\n      goodsData: [],\n      queryParam: {\n        pageSize: 100,\n        pageIndex: 1\n      },\n      timer: null\n    };\n  },\n  methods: {\n    // 获取微信访问令牌\n    async getAccessToken() {\n      try {\n        const response = await axios.get('/cgi-bin/token', {\n          params: {\n            grant_type: 'client_credential',\n            appid: CONFIG.appId,\n            secret: CONFIG.appSecret\n          }\n        });\n        return response.data.access_token;\n      } catch (error) {\n        console.error('获取访问令牌失败:', error);\n        throw error;\n      }\n    },\n    // 查询云数据库\n    async queryCloudDatabase() {\n      try {\n        const accessToken = await this.getAccessToken();\n        const allData = [];\n        let hasMore = true;\n        while (hasMore) {\n          const response = await axios.post(`/wechat-api/tcb/databasequery?access_token=${accessToken}`, {\n            env: CONFIG.env,\n            query: `db.collection(\"goods\").skip(${(this.queryParam.pageIndex - 1) * this.queryParam.pageSize}).limit(${this.queryParam.pageSize}).get()`\n          });\n          allData.push(...response.data.data);\n          hasMore = allData.length < response.data.pager.Total;\n          this.queryParam.pageIndex++;\n        }\n        this.goodsData = allData.map(item => JSON.parse(item));\n        return {\n          data: allData\n        };\n      } catch (error) {\n        console.error('查询云数据库失败:', error);\n        throw error;\n      }\n    }\n  },\n  mounted() {\n    // 首次加载数据\n    this.queryCloudDatabase();\n    // 启动定时器（每5秒请求一次）\n    this.timer = setInterval(() => {\n      this.queryCloudDatabase();\n    }, 5000);\n  },\n  beforeUnmount() {\n    // 组件卸载时清除定时器\n    if (this.timer) {\n      clearInterval(this.timer);\n      this.timer = null;\n    }\n  }\n};","map":{"version":3,"names":["axios","require","CONFIG","appId","appSecret","env","name","data","goodsData","queryParam","pageSize","pageIndex","timer","methods","getAccessToken","response","get","params","grant_type","appid","secret","access_token","error","console","queryCloudDatabase","accessToken","allData","hasMore","post","query","push","length","pager","Total","map","item","JSON","parse","mounted","setInterval","beforeUnmount","clearInterval"],"sources":["C:\\Users\\Administrator\\Desktop\\小程序后台\\coffeeshop\\src\\components\\order\\goods.vue"],"sourcesContent":["<template>\r\n\r\n\r\n    <div>\r\n        <table v-if=\"goodsData.length > 0\">\r\n            <thead>\r\n                <tr>\r\n                    <th>商品ID</th>\r\n                    <th>商品名称</th>\r\n                    <th>价格</th>\r\n                    <th>分类</th>\r\n                    <th>图片</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr v-for=\"(item, index) in goodsData\" :key=\"index\">\r\n                    <td>{{ item._id }}</td>\r\n                    <td>{{ item.name }}</td>\r\n                    <td>{{ item.price }}</td>\r\n                    <td>{{ item.category }}</td>\r\n                    <td>\r\n                        <img :src=\"item.image\" alt=\"商品图片\" style=\"width: 100px; height: 100px;\">\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n        <p v-else>正在加载数据...</p>\r\n    </div>\r\n</template>\r\n\r\n\r\n<script>\r\n\r\nconst axios = require('axios');\r\n// 配置常量\r\nconst CONFIG = {\r\n    appId: 'wx6872b1e938e23c07',\r\n    appSecret: 'bb0342f524bf2fe87416defe5797f40a',\r\n    env: 'cloud1-6gzxjy5k59c1f367'\r\n};\r\n\r\nexport default {\r\n    name: 'goodsList',\r\n    data() {\r\n        return {\r\n            goodsData: [],\r\n            queryParam: {\r\n                pageSize: 100,\r\n                pageIndex: 1,\r\n            },\r\n            timer: null,\r\n        };\r\n    },\r\n    methods: {\r\n        // 获取微信访问令牌\r\n        async getAccessToken() {\r\n            try {\r\n                const response = await axios.get('/cgi-bin/token', {\r\n                    params: {\r\n                        grant_type: 'client_credential',\r\n                        appid: CONFIG.appId,\r\n                        secret: CONFIG.appSecret\r\n                    }\r\n                });\r\n                return response.data.access_token;\r\n            } catch (error) {\r\n                console.error('获取访问令牌失败:', error);\r\n                throw error;\r\n            }\r\n        },\r\n\r\n        // 查询云数据库\r\n        async queryCloudDatabase() {\r\n            try {\r\n                const accessToken = await this.getAccessToken();\r\n                const allData = [];\r\n                let hasMore = true;\r\n\r\n                while (hasMore) {\r\n                    const response = await axios.post(\r\n                        `/wechat-api/tcb/databasequery?access_token=${accessToken}`,\r\n                        {\r\n                            env: CONFIG.env,\r\n                            query: `db.collection(\"goods\").skip(${(this.queryParam.pageIndex - 1) * this.queryParam.pageSize}).limit(${this.queryParam.pageSize}).get()`\r\n                        }\r\n                    );\r\n\r\n                    allData.push(...response.data.data);\r\n                    hasMore = allData.length < response.data.pager.Total;\r\n                    this.queryParam.pageIndex++;\r\n                }\r\n\r\n                this.goodsData = allData.map(item => JSON.parse(item));\r\n                return { data: allData };\r\n            } catch (error) {\r\n                console.error('查询云数据库失败:', error);\r\n                throw error;\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        // 首次加载数据\r\n        this.queryCloudDatabase();\r\n        // 启动定时器（每5秒请求一次）\r\n        this.timer = setInterval(() => {\r\n            this.queryCloudDatabase();\r\n        }, 5000);\r\n    },\r\n    beforeUnmount() {\r\n        // 组件卸载时清除定时器\r\n        if (this.timer) {\r\n            clearInterval(this.timer);\r\n            this.timer = null;\r\n        }\r\n    }\r\n\r\n}\r\n</script>\r\n<style scoped>\r\ntable {\r\n    width: 100%;\r\n    border-collapse: collapse;\r\n}\r\n\r\nth,\r\ntd {\r\n    border: 1px solid #ddd;\r\n    padding: 8px;\r\n    text-align: left;\r\n}\r\n\r\nth {\r\n    background-color: #f2f2f2;\r\n}\r\n</style>"],"mappings":";AAiCA,MAAMA,KAAI,GAAIC,OAAO,CAAC,OAAO,CAAC;AAC9B;AACA,MAAMC,MAAK,GAAI;EACXC,KAAK,EAAE,oBAAoB;EAC3BC,SAAS,EAAE,kCAAkC;EAC7CC,GAAG,EAAE;AACT,CAAC;AAED,eAAe;EACXC,IAAI,EAAE,WAAW;EACjBC,IAAIA,CAAA,EAAG;IACH,OAAO;MACHC,SAAS,EAAE,EAAE;MACbC,UAAU,EAAE;QACRC,QAAQ,EAAE,GAAG;QACbC,SAAS,EAAE;MACf,CAAC;MACDC,KAAK,EAAE;IACX,CAAC;EACL,CAAC;EACDC,OAAO,EAAE;IACL;IACA,MAAMC,cAAcA,CAAA,EAAG;MACnB,IAAI;QACA,MAAMC,QAAO,GAAI,MAAMf,KAAK,CAACgB,GAAG,CAAC,gBAAgB,EAAE;UAC/CC,MAAM,EAAE;YACJC,UAAU,EAAE,mBAAmB;YAC/BC,KAAK,EAAEjB,MAAM,CAACC,KAAK;YACnBiB,MAAM,EAAElB,MAAM,CAACE;UACnB;QACJ,CAAC,CAAC;QACF,OAAOW,QAAQ,CAACR,IAAI,CAACc,YAAY;MACrC,EAAE,OAAOC,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK,CAAC;QACjC,MAAMA,KAAK;MACf;IACJ,CAAC;IAED;IACA,MAAME,kBAAkBA,CAAA,EAAG;MACvB,IAAI;QACA,MAAMC,WAAU,GAAI,MAAM,IAAI,CAACX,cAAc,CAAC,CAAC;QAC/C,MAAMY,OAAM,GAAI,EAAE;QAClB,IAAIC,OAAM,GAAI,IAAI;QAElB,OAAOA,OAAO,EAAE;UACZ,MAAMZ,QAAO,GAAI,MAAMf,KAAK,CAAC4B,IAAI,CAC7B,8CAA8CH,WAAW,EAAE,EAC3D;YACIpB,GAAG,EAAEH,MAAM,CAACG,GAAG;YACfwB,KAAK,EAAE,+BAA+B,CAAC,IAAI,CAACpB,UAAU,CAACE,SAAQ,GAAI,CAAC,IAAI,IAAI,CAACF,UAAU,CAACC,QAAQ,WAAW,IAAI,CAACD,UAAU,CAACC,QAAQ;UACvI,CACJ,CAAC;UAEDgB,OAAO,CAACI,IAAI,CAAC,GAAGf,QAAQ,CAACR,IAAI,CAACA,IAAI,CAAC;UACnCoB,OAAM,GAAID,OAAO,CAACK,MAAK,GAAIhB,QAAQ,CAACR,IAAI,CAACyB,KAAK,CAACC,KAAK;UACpD,IAAI,CAACxB,UAAU,CAACE,SAAS,EAAE;QAC/B;QAEA,IAAI,CAACH,SAAQ,GAAIkB,OAAO,CAACQ,GAAG,CAACC,IAAG,IAAKC,IAAI,CAACC,KAAK,CAACF,IAAI,CAAC,CAAC;QACtD,OAAO;UAAE5B,IAAI,EAAEmB;QAAQ,CAAC;MAC5B,EAAE,OAAOJ,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK,CAAC;QACjC,MAAMA,KAAK;MACf;IACJ;EACJ,CAAC;EACDgB,OAAOA,CAAA,EAAG;IACN;IACA,IAAI,CAACd,kBAAkB,CAAC,CAAC;IACzB;IACA,IAAI,CAACZ,KAAI,GAAI2B,WAAW,CAAC,MAAM;MAC3B,IAAI,CAACf,kBAAkB,CAAC,CAAC;IAC7B,CAAC,EAAE,IAAI,CAAC;EACZ,CAAC;EACDgB,aAAaA,CAAA,EAAG;IACZ;IACA,IAAI,IAAI,CAAC5B,KAAK,EAAE;MACZ6B,aAAa,CAAC,IAAI,CAAC7B,KAAK,CAAC;MACzB,IAAI,CAACA,KAAI,GAAI,IAAI;IACrB;EACJ;AAEJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}