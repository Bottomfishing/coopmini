{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = [\"src\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  return _openBlock(), _createElementBlock(\"div\", null, [$data.goodsData.length > 0 ? (_openBlock(), _createElementBlock(\"table\", _hoisted_1, [_cache[2] || (_cache[2] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"商品ID\"), _createElementVNode(\"th\", null, \"商品名称\"), _createElementVNode(\"th\", null, \"价格\"), _createElementVNode(\"th\", null, \"分类\"), _createElementVNode(\"th\", null, \"图片\")])], -1 /* HOISTED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.goodsData, (item, index) => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: index\n    }, [_createElementVNode(\"td\", null, _toDisplayString(item._id), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(item.name), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(item.price), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(item.category), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"img\", {\n      src: item.image,\n      alt: \"商品图片\",\n      style: {\n        \"width\": \"100px\",\n        \"height\": \"100px\"\n      }\n    }, null, 8 /* PROPS */, _hoisted_2)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_pagination, {\n    \"current-page\": $data.queryParam.page,\n    \"onUpdate:currentPage\": _cache[0] || (_cache[0] = $event => $data.queryParam.page = $event),\n    \"page-size\": $data.queryParam.pageSize,\n    \"onUpdate:pageSize\": _cache[1] || (_cache[1] = $event => $data.queryParam.pageSize = $event),\n    \"page-sizes\": [10, 20, 30],\n    layout: \"total, sizes, prev, pager, next\",\n    total: $data.totalCount,\n    onCurrentChange: $options.queryCloudDatabase,\n    onSizeChange: $options.queryCloudDatabase\n  }, null, 8 /* PROPS */, [\"current-page\", \"page-size\", \"total\", \"onCurrentChange\", \"onSizeChange\"]), _cache[3] || (_cache[3] = _createElementVNode(\"p\", null, \"正在加载数据...\", -1 /* HOISTED */))]);\n}","map":{"version":3,"names":["_createElementBlock","$data","goodsData","length","_hoisted_1","_createElementVNode","_Fragment","_renderList","item","index","key","_toDisplayString","_id","name","price","category","src","image","alt","style","_createVNode","_component_el_pagination","queryParam","page","$event","pageSize","layout","total","totalCount","onCurrentChange","$options","queryCloudDatabase","onSizeChange"],"sources":["C:\\Users\\Administrator\\Desktop\\小程序后台\\coffeeshop\\src\\components\\order\\goods.vue"],"sourcesContent":["<template>\r\n\r\n\r\n\r\n\r\n    <div>\r\n        <table v-if=\"goodsData.length > 0\">\r\n            <thead>\r\n                <tr>\r\n                    <th>商品ID</th>\r\n                    <th>商品名称</th>\r\n                    <th>价格</th>\r\n                    <th>分类</th>\r\n                    <th>图片</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr v-for=\"(item, index) in goodsData\" :key=\"index\">\r\n                    <td>{{ item._id }}</td>\r\n                    <td>{{ item.name }}</td>\r\n                    <td>{{ item.price }}</td>\r\n                    <td>{{ item.category }}</td>\r\n                    <td>\r\n                        <img :src=\"item.image\" alt=\"商品图片\" style=\"width: 100px; height: 100px;\">\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n        <el-pagination v-model:current-page=\"queryParam.page\" v-model:page-size=\"queryParam.pageSize\"\r\n            :page-sizes=\"[10, 20, 30]\" layout=\"total, sizes, prev, pager, next\" :total=\"totalCount\"\r\n            @current-change=\"queryCloudDatabase\" @size-change=\"queryCloudDatabase\" />\r\n        <p v-else>正在加载数据...</p>\r\n    </div>\r\n</template>\r\n\r\n\r\n<script>\r\n\r\nconst axios = require('axios');\r\n// 配置常量\r\nconst CONFIG = {\r\n    appId: 'wx6872b1e938e23c07',\r\n    appSecret: 'bb0342f524bf2fe87416defe5797f40a',\r\n    env: 'cloud1-6gzxjy5k59c1f367'\r\n};\r\n\r\nexport default {\r\n    name: 'goodsList',\r\n    data() {\r\n        return {\r\n            goodsData: [],\r\n            timer: null,\r\n            queryParam: {\r\n                page: 1,\r\n                pageSize: 10,\r\n            },\r\n            totalCount: 0,\r\n        };\r\n    },\r\n    methods: {\r\n        // 获取微信访问令牌\r\n        async getAccessToken() {\r\n            try {\r\n                const response = await axios.get('/cgi-bin/token', {\r\n                    params: {\r\n                        grant_type: 'client_credential',\r\n                        appid: CONFIG.appId,\r\n                        secret: CONFIG.appSecret\r\n                    }\r\n                });\r\n                return response.data.access_token;\r\n            } catch (error) {\r\n                console.error('获取访问令牌失败:', error);\r\n                throw error;\r\n            }\r\n        },\r\n\r\n        // 查询云数据库\r\n        async queryCloudDatabase() {\r\n            try {\r\n                const accessToken = await this.getAccessToken();\r\n                this.queryParam.page = 1;\r\n                const query = {\r\n                    env: CONFIG.env,\r\n                    query: \"db.collection('goods').skip(\" + ((this.queryParam.page - 1) * this.queryParam.pageSize) + \").limit(\" + this.queryParam.pageSize + \").get()\",\r\n                    offset: (this.queryParam.page - 1) * this.queryParam.pageSize,\r\n                    limit: this.queryParam.pageSize\r\n                };\r\n                const response = await axios.post(\r\n                    `/wechat-api/tcb/databasequery?access_token=${accessToken}`,\r\n                    query\r\n                );\r\n                this.goodsData = response.data.data.map(item => JSON.parse(item));\r\n                this.totalCount = response.data.pager.Total;\r\n                return response.data;\r\n            } catch (error) {\r\n                console.error('查询云数据库失败:', error);\r\n                throw error;\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        // 首次加载数据\r\n        this.queryCloudDatabase();\r\n        // 启动定时器（每5秒请求一次）\r\n        this.timer = setInterval(() => {\r\n            this.queryCloudDatabase();\r\n        }, 5000);\r\n    },\r\n    beforeUnmount() {\r\n        // 组件卸载时清除定时器\r\n        if (this.timer) {\r\n            clearInterval(this.timer);\r\n            this.timer = null;\r\n        }\r\n    }\r\n\r\n}\r\n</script>\r\n<style scoped>\r\ntable {\r\n    width: 100%;\r\n    border-collapse: collapse;\r\n}\r\n\r\nth,\r\ntd {\r\n    border: 1px solid #ddd;\r\n    padding: 8px;\r\n    text-align: left;\r\n}\r\n\r\nth {\r\n    background-color: #f2f2f2;\r\n}\r\n</style>"],"mappings":";;;;;;;uBAKIA,mBAAA,CA2BM,cA1BWC,KAAA,CAAAC,SAAS,CAACC,MAAM,Q,cAA7BH,mBAAA,CAqBQ,SAAAI,UAAA,G,0BApBJC,mBAAA,CAQQ,gBAPJA,mBAAA,CAMK,aALDA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,E,wBAGdA,mBAAA,CAUQ,iB,kBATJL,mBAAA,CAQKM,SAAA,QAAAC,WAAA,CARuBN,KAAA,CAAAC,SAAS,GAAzBM,IAAI,EAAEC,KAAK;yBAAvBT,mBAAA,CAQK;MARmCU,GAAG,EAAED;IAAK,IAC9CJ,mBAAA,CAAuB,YAAAM,gBAAA,CAAhBH,IAAI,CAACI,GAAG,kBACfP,mBAAA,CAAwB,YAAAM,gBAAA,CAAjBH,IAAI,CAACK,IAAI,kBAChBR,mBAAA,CAAyB,YAAAM,gBAAA,CAAlBH,IAAI,CAACM,KAAK,kBACjBT,mBAAA,CAA4B,YAAAM,gBAAA,CAArBH,IAAI,CAACO,QAAQ,kBACpBV,mBAAA,CAEK,aADDA,mBAAA,CAAuE;MAAjEW,GAAG,EAAER,IAAI,CAACS,KAAK;MAAEC,GAAG,EAAC,MAAM;MAACC,KAAoC,EAApC;QAAA;QAAA;MAAA;;2EAKlDC,YAAA,CAE6EC,wBAAA;IAFtD,cAAY,EAAEpB,KAAA,CAAAqB,UAAU,CAACC,IAAI;gEAAftB,KAAA,CAAAqB,UAAU,CAACC,IAAI,GAAAC,MAAA;IAAU,WAAS,EAAEvB,KAAA,CAAAqB,UAAU,CAACG,QAAQ;6DAAnBxB,KAAA,CAAAqB,UAAU,CAACG,QAAQ,GAAAD,MAAA;IACvF,YAAU,EAAE,YAAY;IAAEE,MAAM,EAAC,iCAAiC;IAAEC,KAAK,EAAE1B,KAAA,CAAA2B,UAAU;IACrFC,eAAc,EAAEC,QAAA,CAAAC,kBAAkB;IAAGC,YAAW,EAAEF,QAAA,CAAAC;gIACvD1B,mBAAA,CAAuB,WAAb,WAAS,qB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}