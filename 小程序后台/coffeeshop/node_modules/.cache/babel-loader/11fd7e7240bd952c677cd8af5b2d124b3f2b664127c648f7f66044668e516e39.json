{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"content-container\",\n  style: {\n    \"padding-bottom\": \"0\",\n    \"margin-bottom\": \"0\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"input-field\"\n};\nconst _hoisted_3 = {\n  class: \"input-field\"\n};\nconst _hoisted_4 = {\n  class: \"input-field\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_container = _resolveComponent(\"el-container\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n    style: {\n      \"margin\": \"0 0 20px 10px\"\n    }\n  }, \"物品上传:\", -1 /* HOISTED */)), _createVNode(_component_el_container, {\n    class: \"content-row\"\n  }, {\n    default: _withCtx(() => [_cache[2] || (_cache[2] = _createElementVNode(\"div\", {\n      class: \"input-tip\"\n    }, \" 分类ID: \", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_input, {\n      modelValue: $data.queryParam.good,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.queryParam.good = $event)\n    }, null, 8 /* PROPS */, [\"modelValue\"])]), _cache[3] || (_cache[3] = _createElementVNode(\"div\", {\n      class: \"input-tip\"\n    }, \" 分类名称: \", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_input, {\n      modelValue: $data.queryParam.name,\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.queryParam.name = $event)\n    }, null, 8 /* PROPS */, [\"modelValue\"])])]),\n    _: 1 /* STABLE */,\n    __: [2, 3]\n  }), _createCommentVNode(\" 上传按钮 \"), _createVNode(_component_el_container, {\n    class: \"content-row\"\n  }, {\n    default: _withCtx(() => [_cache[5] || (_cache[5] = _createElementVNode(\"div\", {\n      class: \"input-tip\"\n    }, null, -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: _ctx.handleUpload\n    }, {\n      default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\"上传后台云数据\")])),\n      _: 1 /* STABLE */,\n      __: [4]\n    }, 8 /* PROPS */, [\"onClick\"])])]),\n    _: 1 /* STABLE */,\n    __: [5]\n  })]);\n}","map":{"version":3,"names":["class","style","_createElementBlock","_hoisted_1","_createElementVNode","_createVNode","_component_el_container","_hoisted_2","_component_el_input","$data","queryParam","good","$event","_hoisted_3","name","_createCommentVNode","_hoisted_4","_component_el_button","type","onClick","_ctx","handleUpload","_cache"],"sources":["C:\\Users\\Administrator\\Desktop\\小程序后台\\coffeeshop\\src\\components\\set\\lunbotu.vue"],"sourcesContent":["<template>\r\n\r\n    <div class=\"content-container\" style=\"padding-bottom: 0; margin-bottom: 0;\">\r\n        <div style=\"margin: 0 0 20px 10px;\">物品上传:</div>\r\n        <el-container class=\"content-row\">\r\n            <div class=\"input-tip\">\r\n                分类ID:\r\n            </div>\r\n            <div class=\"input-field\">\r\n                <el-input v-model=\"queryParam.good\"></el-input>\r\n            </div>\r\n            <div class=\"input-tip\">\r\n                分类名称:\r\n            </div>\r\n            <div class=\"input-field\">\r\n                <el-input v-model=\"queryParam.name\"></el-input>\r\n            </div>\r\n        </el-container>\r\n\r\n\r\n        <!-- 上传按钮 -->\r\n        <el-container class=\"content-row\">\r\n            <div class=\"input-tip\">\r\n            </div>\r\n            <div class=\"input-field\">\r\n                <el-button type=\"primary\" @click=\"handleUpload\">上传后台云数据</el-button>\r\n            </div>\r\n        </el-container>\r\n    </div>\r\n    \r\n</template>\r\n\r\n<script>\r\nconst axios = require('axios');\r\nconst CONFIG = {\r\n    appId: 'wx6872b1e938e23c07',\r\n    appSecret: 'bb0342f524bf2fe87416defe5797f40a',\r\n    env: 'cloud1-6gzxjy5k59c1f367'\r\n};\r\nexport default {\r\n    name: 'lunBotu',\r\n    data() {\r\n        return {\r\n            goodsData: [],\r\n            queryParam: {\r\n                page: 1,\r\n                limit: 10,\r\n                good: '',\r\n                name: ''\r\n            },\r\n            total: 0,\r\n            timer: null\r\n        };\r\n    },\r\n    methods: {\r\n        \r\n        // 获取微信访问令牌\r\n        async getAccessToken() {\r\n            try {\r\n                const response = await axios.get('/cgi-bin/token', {\r\n                    params: {\r\n                        grant_type: 'client_credential',\r\n                        appid: CONFIG.appId,\r\n                        secret: CONFIG.appSecret\r\n                    }\r\n                });\r\n                return response.data.access_token;\r\n            } catch (error) {\r\n                console.error('获取访问令牌失败:', error);\r\n                throw error;\r\n            }\r\n        },\r\n\r\n\r\n        // 查询云数据库\r\n        async queryCloudDatabase() {\r\n            try {\r\n                const accessToken = await this.getAccessToken();\r\n                const query = {\r\n                    env: CONFIG.env,\r\n                    query: `db.collection('lunbotu').skip(${(this.queryParam.page - 1) * this.queryParam.limit}).limit(${this.queryParam.limit}).get()`,\r\n                    totalQuery: \"db.collection('lunbotu').count()\"\r\n                };\r\n                const [dataRes, countRes] = await Promise.all([\r\n                    axios.post(`/wechat-api/tcb/databasequery?access_token=${accessToken}`, { env: CONFIG.env, query: query.query }),\r\n                    axios.post(`/wechat-api/tcb/databasecount?access_token=${accessToken}`, { env: CONFIG.env, query: query.totalQuery })\r\n                ]);\r\n                const newData = dataRes.data.data ? dataRes.data.data.map(item => JSON.parse(item)) : [];\r\n                if (JSON.stringify(newData) !== JSON.stringify(this.goodsData)) {\r\n                    this.goodsData = newData;\r\n                    this.total = countRes.data.count;\r\n                }\r\n                return dataRes.data;\r\n            } catch (error) {\r\n                console.error('查询云数据库失败:', error);\r\n                throw error;\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        this.queryCloudDatabase();\r\n        this.timer = setInterval(() => {\r\n            this.queryCloudDatabase().catch(() => { });\r\n        }, 10000);\r\n    },\r\n    beforeUnmount() {\r\n        if (this.timer) {\r\n            clearInterval(this.timer);\r\n            this.timer = null;\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style scoped>\r\ntable {\r\n    width: 100%;\r\n    border-collapse: collapse;\r\n}\r\n\r\nth,\r\ntd {\r\n    border: 1px solid #ddd;\r\n    padding: 8px;\r\n    text-align: left;\r\n}\r\n\r\nth {\r\n    background-color: #f2f2f2;\r\n}\r\n</style>\r\n"],"mappings":";;EAESA,KAAK,EAAC,mBAAmB;EAACC,KAA4C,EAA5C;IAAA;IAAA;EAAA;;;EAMlBD,KAAK,EAAC;AAAa;;EAMnBA,KAAK,EAAC;AAAa;;EAUnBA,KAAK,EAAC;AAAa;;;;;uBAtBhCE,mBAAA,CA0BM,OA1BNC,UA0BM,G,0BAzBFC,mBAAA,CAA+C;IAA1CH,KAA8B,EAA9B;MAAA;IAAA;EAA8B,GAAC,OAAK,sBACzCI,YAAA,CAaeC,uBAAA;IAbDN,KAAK,EAAC;EAAa;sBAC7B,MAEM,C,0BAFNI,mBAAA,CAEM;MAFDJ,KAAK,EAAC;IAAW,GAAC,SAEvB,sBACAI,mBAAA,CAEM,OAFNG,UAEM,GADFF,YAAA,CAA+CG,mBAAA;kBAA5BC,KAAA,CAAAC,UAAU,CAACC,IAAI;iEAAfF,KAAA,CAAAC,UAAU,CAACC,IAAI,GAAAC,MAAA;yEAEtCR,mBAAA,CAEM;MAFDJ,KAAK,EAAC;IAAW,GAAC,SAEvB,sBACAI,mBAAA,CAEM,OAFNS,UAEM,GADFR,YAAA,CAA+CG,mBAAA;kBAA5BC,KAAA,CAAAC,UAAU,CAACI,IAAI;iEAAfL,KAAA,CAAAC,UAAU,CAACI,IAAI,GAAAF,MAAA;;;;MAK1CG,mBAAA,UAAa,EACbV,YAAA,CAMeC,uBAAA;IANDN,KAAK,EAAC;EAAa;sBAC7B,MACM,C,0BADNI,mBAAA,CACM;MADDJ,KAAK,EAAC;IAAW,6BAEtBI,mBAAA,CAEM,OAFNY,UAEM,GADFX,YAAA,CAAmEY,oBAAA;MAAxDC,IAAI,EAAC,SAAS;MAAEC,OAAK,EAAEC,IAAA,CAAAC;;wBAAc,MAAOC,MAAA,QAAAA,MAAA,O,iBAAP,SAAO,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}